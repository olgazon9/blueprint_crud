<!DOCTYPE html>
<html>

<head>
    <title>Book Library</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
    <h1>Welcome to the Book Library</h1>
    <button id="addBookButton">Add a Book</button>

    <div id="bookFormContainer" style="display: none;">
        <form id="bookForm">
            <label for="title">Title:</label>
            <input type="text" id="title" name="title" required><br>

            <label for="author">Author:</label>
            <input type="text" id="author" name="author" required><br>

            <label for="publication_year">Publication Year:</label>
            <input type="number" id="publication_year" name="publication_year" required><br>

            <label for="genre">Genre:</label>
            <input type="text" id="genre" name="genre" required><br>

            <button type="submit">Create Book</button>
        </form>
        <div id="message"></div>
    </div>
    <!-- Button to toggle book list visibility -->
    <button id="toggleBooksButton">Show Books</button>

    <div id="bookList" style="display: none;">
        <!-- This is where the book list will be displayed -->
    </div>
   <!-- Button to toggle search visibility -->
   <button id="toggleSearchButton">Toggle Search</button>
   </div>
    <!-- Search form -->
    <form id="searchForm">
        <label for="searchQuery">Search for Books:</label>
        <input type="text" id="searchQuery" name="q" required>
        <button type="submit">Search</button>
    </form>

    <div id="searchResults" style="display: none;">
        <!-- This is where the search results will be displayed -->
    </div>
    <br>
    <!-- Button to toggle the form visibility -->
    <button id="showFormButton">Create Loaner</button>
    
    <!-- Loaner creation form (initially hidden) -->
    <form id="loanerForm" style="display: none;">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required><br><br>
        
        <label for="contact">Contact:</label>
        <input type="text" id="contact" name="contact" required><br><br>
        
        <button type="submit">Create Loaner</button>
    </form>
    <!-- Button to fetch and display all loaners -->
    <button id="showLoanersButton">Show All Loaners</button>
    
    <!-- Container to display loaners -->
    <div id="loanersList" style="display: none;"></div>
    <!-- script for books  -->
    <script>
        const addBookButton = document.getElementById("addBookButton");
        const bookFormContainer = document.getElementById("bookFormContainer");

        addBookButton.addEventListener("click", function () {
            bookFormContainer.style.display = "block";
        });

        document.getElementById("bookForm").addEventListener("submit", function (event) {
            event.preventDefault();

            const title = document.getElementById("title").value;
            const author = document.getElementById("author").value;
            const publication_year = document.getElementById("publication_year").value;
            const genre = document.getElementById("genre").value;

            const bookData = {
                title: title,
                author: author,
                publication_year: publication_year,
                genre: genre
            };

            axios.post('/books/books', bookData)
                .then(function (response) {
                    document.getElementById("message").textContent = response.data.message;
                    // Hide the form and show the success message
                    bookFormContainer.style.display = "none";
                    document.getElementById("message").style.display = "block";
                })
                .catch(function (error) {
                    console.error(error);
                });
        });

        const toggleBooksButton = document.getElementById("toggleBooksButton");
        const bookList = document.getElementById("bookList");
        let booksVisible = false; // Track the visibility state

        // Function to toggle book list visibility
        function toggleBookList() {
            if (booksVisible) {
                bookList.style.display = "none";
                toggleBooksButton.textContent = "Show Books";
            } else {
                bookList.style.display = "block";
                toggleBooksButton.textContent = "Hide Books";
            }
            booksVisible = !booksVisible; // Toggle the visibility state
        }

        toggleBooksButton.addEventListener("click", function () {
            if (booksVisible) {
                // If books are visible, hide them
                toggleBookList();
            } else {
                // If books are not visible, fetch and display them
                axios.get('/books/books')
                    .then(function (response) {
                        const books = response.data.books;
                        const bookListHTML = books.map(book => `
                            <div>
                                <strong>Title:</strong> ${book.title}<br>
                                <strong>Author:</strong> ${book.author}<br>
                                <strong>Publication Year:</strong> ${book.publication_year}<br>
                                <strong>Genre:</strong> ${book.genre}<br>
                                <button onclick="deleteBook(${book.id})">Delete</button>
                                <button onclick="editBook(${book.id})">Edit</button>
                            </div>
                            <hr>
                        `).join('');

                        bookList.innerHTML = bookListHTML;
                        toggleBookList();
                    })
                    .catch(function (error) {
                        console.error(error);
                    });
            }
        });

        // Function to edit a book
        function editBook(bookId) {
            // Replace book information with edit form
            const bookElement = document.querySelector(`#bookList div:nth-child(${bookId})`);
            const book = bookElement.innerHTML;
            bookElement.innerHTML = `
                <div>
                  title : <input type="text" id="editTitle_${bookId}" value="${book.title}"> <br>
                   author :  <input type="text" id="editAuthor_${bookId}" value="${book.author}"> <br>
                   publication_year :  <input type="number" id="editPublicationYear_${bookId}" value="${book.publication_year}"> <br>
                   genre :  <input type="text" id="editGenre_${bookId}" value="${book.genre}">
                    <button onclick="updateBook(${bookId})">Update</button>
                </div>
                <hr>
            `;
        }

        // Function to update a book
        function updateBook(bookId) {
            const editTitle = document.getElementById(`editTitle_${bookId}`).value;
            const editAuthor = document.getElementById(`editAuthor_${bookId}`).value;
            const editPublicationYear = document.getElementById(`editPublicationYear_${bookId}`).value;
            const editGenre = document.getElementById(`editGenre_${bookId}`).value;

            const bookData = {
                title: editTitle,
                author: editAuthor,
                publication_year: editPublicationYear,
                genre: editGenre
            };

            axios.put(`/books/books/${bookId}`, bookData)
                .then(function (response) {
                    // Update the book's information in the list
                    const bookElement = document.querySelector(`#bookList div:nth-child(${bookId})`);

                    bookElement.innerHTML = `
                        <strong>Title:</strong> ${editTitle}<br>
                        <strong>Author:</strong> ${editAuthor}<br>
                        <strong>Publication Year:</strong> ${editPublicationYear}<br>
                        <strong>Genre:</strong> ${editGenre}<br>
                        <button onclick="deleteBook(${bookId})">Delete</button>
                        <button onclick="editBook(${bookId})">Edit</button>
                    `;

                    console.log(response.data.message);
                })
                .catch(function (error) {
                    console.error(error);
                });
        }

        // Function to delete a book by its ID
        function deleteBook(bookId) {
            axios.delete(`/books/books/${bookId}`)
                .then(function (response) {
                    // Book deleted successfully, refresh the book list
                    toggleBooksButton.click(); // Simulate a click to refresh the list
                    console.log(response.data.message);
                })
                .catch(function (error) {
                    console.error(error);
                });
        }

        const toggleSearchButton = document.getElementById("toggleSearchButton");
        const searchForm = document.getElementById("searchForm");
        const searchResults = document.getElementById("searchResults");

        let searchVisible = false; // Track the visibility state

        // Function to toggle search visibility
        function toggleSearch() {
            if (searchVisible) {
                searchForm.style.display = "none";
                searchResults.style.display = "none";
                toggleSearchButton.textContent = "Show Search";
            } else {
                searchForm.style.display = "block";
                toggleSearchButton.textContent = "Hide Search";
            }
            searchVisible = !searchVisible; // Toggle the visibility state
        }

        toggleSearchButton.addEventListener("click", function () {
            toggleSearch();
        });

        searchForm.addEventListener("submit", function (event) {
            event.preventDefault();

            const query = searchQuery.value;

            axios.get(`books/search-books?q=${query}`)
                .then(function (response) {
                    const searchResultsData = response.data.search_results;
                    const searchResultsHTML = searchResultsData.map(result => `
                        <div>
                            <strong>Title:</strong> ${result.title}<br>
                            <strong>Author:</strong> ${result.author}<br>
                            <strong>Publication Year:</strong> ${result.publication_year}<br>
                            <strong>Genre:</strong> ${result.genre}<br>
                        </div>
                        <hr>
                    `).join('');

                    searchResults.innerHTML = searchResultsHTML;
                    searchResults.style.display = "block";
                })
                .catch(function (error) {
                    console.error(error);
                });
        });
    </script>
    <!-- script for loaners  -->
    <script>

        // Function to toggle the form visibility
        function toggleFormVisibility() {
            const form = document.getElementById("loanerForm");
            form.style.display = form.style.display === "none" ? "block" : "none";
        }

        // Event listener for the "Create Loaner" button
        document.getElementById("showFormButton").addEventListener("click", function() {
            toggleFormVisibility();
        });

        document.getElementById("loanerForm").addEventListener("submit", function(event) {
            event.preventDefault(); // Prevent the default form submission

            const name = document.getElementById("name").value;
            const contact = document.getElementById("contact").value;

            // Send a POST request to your Flask route
            axios.post('/loaners/loaners', { name, contact })
                .then(function (response) {
                    alert(response.data.message);
                    toggleFormVisibility(); // Hide the form after submission
                })
                .catch(function (error) {
                    console.error(error);
                    alert("An error occurred while creating the loaner.");
                });
        });
        
    </script>
</body>

</html>
